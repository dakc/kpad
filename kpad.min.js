/*!
 * kpad v1.0.0 (https://github.com/dakc/kpad)
 * Copyright (c) 2020 DA KC
 * MIT License (https://raw.githubusercontent.com/dakc/kpad/master/LICENSE)
 */
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var kpad=function(){function n(t,e){_classCallCheck(this,n),this._pEl=t,this._cnf={pc:"#ff0000",bs:1,bsi:2,bg:"#ffffff",cl:[]},this._lc="round",this._df=!1,this._stp={x:0,y:0},this._ctx=null,this._can=null,this._rect=null,this.r(e),this.c()}return _createClass(n,[{key:"r",value:function(t){try{if("object"!=_typeof(t))return;var e,n;"penColor"in t&&(this._cnf.pc=t.penColor),"backgroundColor"in t&&(this._cnf.bg=t.backgroundColor),"colorList"in t&&(this._cnf.cl=t.colorList),"sizeIncreement"in t&&(this._cnf.bsi=parseInt(t.sizeIncreement)||this._cnf.bsi),"sizeIncreement"in t&&((e=parseInt(t.sizeIncreement))<=1&&(e=1),this._cnf.bsi=e),"brushSize"in t&&(n=1<(n=parseInt(t.brushSize))?n*this._cnf.bsi:1,this._cnf.bs=n)}catch(t){console.error(t)}}},{key:"c",value:function(){var t=document.createElement("canvas");if(this._pEl.append(t),this._ctx=t.getContext("2d"),!this._ctx)throw new Error("canvas is not supported on your browser!");var e=t.getBoundingClientRect();this._can=t,this._rect=e;var n=this;window.addEventListener("load",function(){var e;n.rc(),t.addEventListener("mousedown",n.dSt.bind(n)),t.addEventListener("mousemove",n.dCnt.bind(n)),t.addEventListener("mouseup",n.dEn.bind(n)),t.addEventListener("touchstart",n.dSt.bind(n)),t.addEventListener("touchmove",n.dCnt.bind(n)),t.addEventListener("touchend",n.dEn.bind(n)),n._cnf.cl.length&&(n.acb(),e=0,document.querySelectorAll(".kpad-color-button").forEach(function(t){t.classList.contains(n._cnf.pc)&&(e=1,t.click())}),e||document.querySelector(".kpad-color-button").click())}),window.addEventListener("scroll",function(){t&&e&&(n._rect=t.getBoundingClientRect())})}},{key:"rc",value:function(){var t,e,n,o,i,c;this._can&&(t=window.getComputedStyle(this._pEl).getPropertyValue("padding-left"),e=window.getComputedStyle(this._pEl).getPropertyValue("padding-right"),n=this._pEl.offsetWidth-parseFloat(t)-parseFloat(e),this._can.setAttribute("width","".concat(n,"px")),o=window.getComputedStyle(this._pEl).getPropertyValue("padding-top"),i=window.getComputedStyle(this._pEl).getPropertyValue("padding-bottom"),c=this._pEl.offsetHeight-parseFloat(o)-parseFloat(i),this._can.setAttribute("height","".concat(c,"px")))}},{key:"d",value:function(t,e){this._ctx.strokeStyle=this._cnf.pc;var n=this._cnf.bs;"square"==this._lc&&(n=this._cnf.bs<5?10:2*this._cnf.bs),this._ctx.lineWidth=n,this._ctx.lineJoin="round",this._ctx.lineCap=this._lc,this._ctx.beginPath(),this._ctx.moveTo(this._stp.x,this._stp.y),this._ctx.lineTo(t,e),this._ctx.stroke(),this._ctx.closePath(),this._stp={x:t,y:e}}},{key:"gcl",value:function(t){if(t){var e,n="touches"in t?(e=t.touches[0].clientX,t.touches[0].clientY):(e=t.clientX,t.clientY);return{x:e,y:n}}}},{key:"dSt",value:function(t){var e=this.gcl(t);this._df=!0,this._stp.x=e.x-this._rect.left,this._stp.y=e.y-this._rect.top,t.stopPropagation()}},{key:"dCnt",value:function(t){var e,n,o;this._df&&(n=(e=this.gcl(t)).x-this._rect.left,o=e.y-this._rect.top,this._can.getContext&&this.d(n,o),t.cancelable&&t.preventDefault(),t.stopPropagation())}},{key:"dEn",value:function(t){this._df=!1,t.stopPropagation()}},{key:"isEmpty",value:function(){var t=this._can.getContext("2d");return!new Uint32Array(t.getImageData(0,0,this._can.width,this._can.height).data.buffer).some(function(t){return 0!==t})}},{key:"clear",value:function(){this._can.getContext("2d").clearRect(0,0,this._can.width,this._can.height)}},{key:"style",value:function(){var t=document.createElement("style");t.textContent="\n        canvas{\n            background: ".concat(this._cnf.bg,'\n        }\n        #kpad_control_box{\n            position: absolute;\n            top: 5px;\n            left: 10%;\n            width:80%;\n            display: grid;\n            grid-template-columns: 2fr 2fr 1fr;\n            border: 1px solid;\n            border-radius: 10px;\n        }\n\n  \n        #kpad_control_box button{\n            margin: 5px;\n            border: none;\n            width: 40px;\n            height: 40px;\n            outline: none;\n        }\n\n        button.active{\n            width: 45px !important;\n            height: 45px !important;\n        }\n\n        .kpad-color-button{\n            border-radius: 50%;\n        }\n\n        #kpad_size_box button{\n            font-size:2rem;\n            line-height:2rem;\n        }\n\n        .kpad-clear-button{\n            background-image: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48" height="48" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);"><path d="M16.24 3.56l4.95 4.94c.78.79.78 2.05 0 2.84L12 20.53a4.008 4.008 0 0 1-5.66 0L2.81 17c-.78-.79-.78-2.05 0-2.84l10.6-10.6c.79-.78 2.05-.78 2.83 0M4.22 15.58l3.54 3.53c.78.79 2.04.79 2.83 0l3.53-3.53l-4.95-4.95l-4.95 4.95z" fill="currentColor"/></svg>\');\n            background-repeat: no-repeat;\n            background-position: center;\n            border: 1px solid ').concat(this._cnf.bg,";\n        }\n\n        #kpad_delete_box{\n            text-align:right;\n        }\n        \n        #kpad_delete_box button{\n            color:#ff0000;\n            font-size:0.8rem;\n        }\n        "),document.querySelector("body").appendChild(t)}},{key:"acb",value:function(){this.style();var t=document.createElement("div");t.id="kpad_control_box",document.querySelector("body").appendChild(t),this.aCb(t),this.aSb(t),this.aDb(t),this.mcd()}},{key:"sdbs",value:function(){var t=this._cnf.bs;1<this._cnf.bs&&(t=(t=Math.ceil(this._cnf.bs/this._cnf.bsi))<=1?1:t),document.querySelector(".kpad-size-label").textContent=t}},{key:"aCb",value:function(t){var n=this,o=document.createElement("div");o.id="kpad_color_box",t.appendChild(o),this._cnf.cl.forEach(function(e){var t=document.createElement("button");t.className="kpad-color-button "+e,n._cnf.pc==e&&t.classList.add("active"),t.style.backgroundColor=e,t.addEventListener("click",function(t){n._cnf.pc=e,n._lc="round",n.rcs(),t.target.classList.add("active"),document.querySelector(".kpad-clear-button").style.border="none"}),o.appendChild(t)});var e=document.createElement("button");e.className="kpad-clear-button",e.addEventListener("click",function(t){n._cnf.pc=n._cnf.bg,n._lc="square",t.target.style.border="1px solid red"}),o.appendChild(e)}},{key:"aSb",value:function(t){var n=this,o=document.createElement("div");o.id="kpad_size_box",t.appendChild(o);function e(e){var t=document.createElement("button");t.className="kpad-size-button",t.textContent=e,t.addEventListener("click",function(t){"+"==e?n._cnf.bs+=n._cnf.bsi:(n._cnf.bs-=n._cnf.bsi,n._cnf.bs<=0&&(n._cnf.bs=1)),n.sdbs()}),o.appendChild(t)}e("+");var i=document.createElement("span");i.className="kpad-size-label",o.appendChild(i),n.sdbs(),e("-")}},{key:"aDb",value:function(t){var e=this,n=document.createElement("div");n.id="kpad_delete_box",t.appendChild(n);var o=document.createElement("button");o.className="kpad-clear-all-button",o.textContent="New",o.addEventListener("click",function(t){return e.clear()}),n.appendChild(o)}},{key:"rcs",value:function(){document.querySelectorAll("button.kpad-color-button").forEach(function(t){return t.classList.remove("active")})}},{key:"mcd",value:function(){function t(t){"BUTTON"==t.target.nodeName||((t=t||window.event).preventDefault(),c=self.gcl(t),i.addEventListener("mousemove",e),i.addEventListener("touchmove",e),i.addEventListener("mouseup",n),i.addEventListener("touchend",n))}function e(t){(t=t||window.event).preventDefault();var e=self.gcl(t),n=i.offsetLeft-(c.x-e.x),o=i.offsetTop-(c.y-e.y);i.style.left=n+"px",i.style.top=o+"px",c=e}function n(){i.removeEventListener("mousemove",e),i.removeEventListener("touchmove",e),i.removeEventListener("mouseup",n),i.removeEventListener("touchend",n)}self=this;var i=document.getElementById("kpad_control_box"),c={x:0,y:0};i.addEventListener("mousedown",t),i.addEventListener("touchstart",t)}}]),n}();